{
  "openapi": "3.0.0",
  "paths": {
    "/": {
      "get": {
        "operationId": "AppController_getHello",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Service is healthy"
          }
        },
        "summary": "Health check endpoint",
        "tags": ["health"]
      }
    },
    "/health": {
      "get": {
        "operationId": "AppController_healthCheck",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Service is healthy"
          }
        },
        "summary": "Health check for monitoring",
        "tags": ["health"]
      }
    },
    "/users": {
      "post": {
        "description": "Creates a new user in Redis. If userId is not provided, a new UUID will be generated.",
        "operationId": "UsersController_createUser",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateRedisUserDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "User successfully created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RedisUserResponseDto"
                }
              }
            }
          },
          "400": {
            "description": "Invalid input data",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "statusCode": {
                      "type": "number",
                      "example": 400
                    },
                    "message": {
                      "type": "array",
                      "items": "@{type=string}"
                    },
                    "error": {
                      "type": "string",
                      "example": "Bad Request"
                    }
                  }
                }
              }
            }
          },
          "409": {
            "description": "User with the provided userId already exists",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "statusCode": {
                      "type": "number",
                      "example": 409
                    },
                    "message": {
                      "type": "string",
                      "example": "User with userId ... already exists"
                    },
                    "error": {
                      "type": "string",
                      "example": "Conflict"
                    }
                  }
                }
              }
            }
          }
        },
        "summary": "Create a new user",
        "tags": ["users"]
      }
    },
    "/users/{userId}": {
      "get": {
        "description": "Retrieves a user by their userId (UUID)",
        "operationId": "UsersController_getUser",
        "parameters": [
          {
            "name": "userId",
            "required": true,
            "in": "path",
            "description": "User ID (UUID)",
            "schema": {
              "example": "123e4567-e89b-12d3-a456-426614174000",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "User found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RedisUserResponseDto"
                }
              }
            }
          },
          "404": {
            "description": "User not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "statusCode": {
                      "type": "number",
                      "example": 404
                    },
                    "message": {
                      "type": "string",
                      "example": "User with userId ... not found"
                    },
                    "error": {
                      "type": "string",
                      "example": "Not Found"
                    }
                  }
                }
              }
            }
          }
        },
        "summary": "Get user by ID",
        "tags": ["users"]
      },
      "delete": {
        "description": "Deletes a user by their userId (UUID)",
        "operationId": "UsersController_deleteUser",
        "parameters": [
          {
            "name": "userId",
            "required": true,
            "in": "path",
            "description": "User ID (UUID)",
            "schema": {
              "example": "123e4567-e89b-12d3-a456-426614174000",
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "User successfully deleted"
          },
          "404": {
            "description": "User not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "statusCode": {
                      "type": "number",
                      "example": 404
                    },
                    "message": {
                      "type": "string",
                      "example": "User with userId ... not found"
                    },
                    "error": {
                      "type": "string",
                      "example": "Not Found"
                    }
                  }
                }
              }
            }
          }
        },
        "summary": "Delete user",
        "tags": ["users"]
      }
    },
    "/users/{userId}/name": {
      "patch": {
        "description": "Updates the name of an existing user",
        "operationId": "UsersController_updateName",
        "parameters": [
          {
            "name": "userId",
            "required": true,
            "in": "path",
            "description": "User ID (UUID)",
            "schema": {
              "example": "123e4567-e89b-12d3-a456-426614174000",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "New user name",
                    "example": "Jane Doe",
                    "minLength": 1,
                    "maxLength": 100
                  }
                },
                "required": ["name"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "User name updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RedisUserResponseDto"
                }
              }
            }
          },
          "400": {
            "description": "Invalid input data"
          },
          "404": {
            "description": "User not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "statusCode": {
                      "type": "number",
                      "example": 404
                    },
                    "message": {
                      "type": "string",
                      "example": "User with userId ... not found"
                    },
                    "error": {
                      "type": "string",
                      "example": "Not Found"
                    }
                  }
                }
              }
            }
          }
        },
        "summary": "Update user name",
        "tags": ["users"]
      }
    },
    "/rooms": {
      "post": {
        "description": "Creates a new room and broadcasts the event via WebSocket",
        "operationId": "RoomsController_createRoom",
        "parameters": [],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateRoomDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Room successfully created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "roomId": {
                      "type": "string",
                      "example": "123e4567-e89b-12d3-a456-426614174000"
                    }
                  }
                }
              }
            }
          }
        },
        "summary": "Create a new room",
        "tags": ["rooms"]
      }
    },
    "/rooms/{id}": {
      "get": {
        "description": "Retrieves room data by room ID",
        "operationId": "RoomsController_getRoom",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "Room ID (UUID)",
            "schema": {
              "example": "123e4567-e89b-12d3-a456-426614174000",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Room found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RoomResponseDto"
                }
              }
            }
          },
          "404": {
            "description": "Room not found"
          }
        },
        "summary": "Get room by ID",
        "tags": ["rooms"]
      }
    },
    "/rooms/{id}/join": {
      "post": {
        "description": "Adds a user to a room and broadcasts the update via WebSocket",
        "operationId": "RoomsController_joinRoom",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "Room ID (UUID)",
            "schema": {
              "example": "123e4567-e89b-12d3-a456-426614174000",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "userId": {
                    "type": "string",
                    "description": "User ID (UUID)",
                    "example": "123e4567-e89b-12d3-a456-426614174000"
                  }
                },
                "required": ["userId"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "User successfully joined the room",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RoomResponseDto"
                }
              }
            }
          },
          "400": {
            "description": "Invalid input data"
          },
          "404": {
            "description": "Room not found"
          }
        },
        "summary": "Join a room",
        "tags": ["rooms"]
      }
    },
    "/rooms/{id}/leave": {
      "post": {
        "description": "Removes a user from a room and broadcasts the update via WebSocket",
        "operationId": "RoomsController_leaveRoom",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "Room ID (UUID)",
            "schema": {
              "example": "123e4567-e89b-12d3-a456-426614174000",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "userId": {
                    "type": "string",
                    "description": "User ID (UUID)",
                    "example": "123e4567-e89b-12d3-a456-426614174000"
                  }
                },
                "required": ["userId"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "User successfully left the room",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RoomResponseDto"
                }
              }
            }
          },
          "404": {
            "description": "Room not found"
          }
        },
        "summary": "Leave a room",
        "tags": ["rooms"]
      }
    },
    "/rooms/{id}/choice": {
      "post": {
        "description": "Records a user\u0027s movie choice and broadcasts the update via WebSocket",
        "operationId": "RoomsController_chooseMovie",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "description": "Room ID (UUID)",
            "schema": {
              "example": "123e4567-e89b-12d3-a456-426614174000",
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "userId": {
                    "type": "string",
                    "description": "User ID (UUID)",
                    "example": "123e4567-e89b-12d3-a456-426614174000"
                  },
                  "movieId": {
                    "type": "string",
                    "description": "Movie ID",
                    "example": "movie-123"
                  }
                },
                "required": ["userId", "movieId"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Movie choice recorded",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RoomResponseDto"
                }
              }
            }
          },
          "400": {
            "description": "Invalid input data or user not in room"
          },
          "404": {
            "description": "Room not found"
          }
        },
        "summary": "Choose a movie",
        "tags": ["rooms"]
      }
    }
  },
  "info": {
    "title": "MM Admin API",
    "description": "API documentation for MM Admin backend",
    "version": "1.0",
    "contact": {}
  },
  "tags": [
    {
      "name": "users",
      "description": "User management endpoints"
    },
    {
      "name": "rooms",
      "description": "Room management endpoints"
    },
    {
      "name": "tokens",
      "description": "Token management endpoints"
    }
  ],
  "servers": [
    {
      "url": "http://localhost:3000",
      "description": "Development server"
    }
  ],
  "components": {
    "schemas": {
      "CreateRedisUserDto": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "User name",
            "example": "John Doe",
            "minLength": 1,
            "maxLength": 100
          },
          "userId": {
            "type": "string",
            "description": "User ID (UUID). If not provided, a new UUID will be generated",
            "example": "123e4567-e89b-12d3-a456-426614174000",
            "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$"
          }
        }
      },
      "RedisUserResponseDto": {
        "type": "object",
        "properties": {
          "userId": {
            "type": "string",
            "description": "Unique user identifier (UUID)",
            "example": "123e4567-e89b-12d3-a456-426614174000"
          },
          "name": {
            "type": "string",
            "description": "User name",
            "example": "John Doe"
          },
          "lastActive": {
            "type": "number",
            "description": "Last active timestamp (Unix timestamp in milliseconds)",
            "example": 1704067200000
          }
        },
        "required": ["userId", "name", "lastActive"]
      },
      "CreateRoomDto": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Optional room name",
            "example": "Movie Night"
          }
        }
      },
      "RoomResponseDto": {
        "type": "object",
        "properties": {
          "roomId": {
            "type": "string",
            "description": "Room ID (UUID)",
            "example": "123e4567-e89b-12d3-a456-426614174000"
          },
          "users": {
            "description": "List of user IDs in the room",
            "example": ["user1", "user2"],
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "choices": {
            "type": "object",
            "description": "User choices (userId -\u003e movieId)",
            "additionalProperties": {
              "type": "string"
            },
            "example": {
              "user1": "movie-123",
              "user2": "movie-456"
            }
          },
          "createdAt": {
            "type": "number",
            "description": "Room creation timestamp",
            "example": 1704067200000
          },
          "updatedAt": {
            "type": "number",
            "description": "Room last update timestamp",
            "example": 1704067200000
          }
        },
        "required": ["roomId", "users", "choices"]
      }
    }
  }
}
